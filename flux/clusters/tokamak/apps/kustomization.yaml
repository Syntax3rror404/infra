---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Include cluster apps which are deployed in the tokamak cluster
resources:
  # - ../../../apps/podinfo/overlays/prod
  - ../../../apps/weave-gitops/overlays/prod

# # Cluster-specific patches
# patches:
#   # Update podinfo ingress with cluster domain
#   - patch: |
#       - op: replace
#         path: /spec/rules/0/host
#         value: podinfo.${cilium_domain}
#     target:
#       kind: Ingress
#       name: podinfo-cilium
#       namespace: podinfo
  
#   # Update weave-gitops ingress with cluster domain
#   - patch: |
#       - op: replace
#         path: /spec/rules/0/host
#         value: gitops.${cilium_domain}
#     target:
#       kind: Ingress
#       name: weave-gitops-cilium
#       namespace: weave-gitops

# Apply cluster-specific patches per app
patches:
  - path: weave-gitops-values.yaml
    target:
      kind: HelmRelease
      name: weave-gitops
      namespace: weave-gitops
    options:
      allowNameChange: false
      allowKindChange: false
